<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="dashboard/characters"></ion-back-button>
    </ion-buttons>

    <ion-title>
      <ng-container *ngIf="data.char$ | async as character">
        {{ character?.name || 'Loading...' }}
      </ng-container>
    </ion-title>

    <ion-buttons slot="end">

      <ion-button (click)="notification.rollDice()">
        <ion-icon slot="icon-only" name="dice"></ion-icon>
      </ion-button>

      <ion-button (click)="openBackground()">
        <ion-icon slot="icon-only" name="book"></ion-icon>
      </ion-button>

      <ion-button (click)="openCampaign()">
        <ion-icon slot="icon-only" name="library"></ion-icon>
      </ion-button>

      <ion-button (click)="openAdvancement()">
        <ion-icon slot="icon-only" name="bonfire"></ion-icon>
      </ion-button>

      <ng-container *ngIf="data.char$ | async as character">
        <ion-button (click)="pdf.exportCharacter(character)">
          <ion-icon slot="icon-only" name="download"></ion-icon>
        </ion-button>
      </ng-container>

    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ng-container *ngIf="data.char$ | async as character">
    <ion-row>
      <ion-col size="12" size-lg="6">

        <ion-card>
          <ion-card-header>
            <ion-card-title>{{ character.archetype }}</ion-card-title>
            <ion-card-subtitle>{{ character.species }} / {{ character.pronouns }}</ion-card-subtitle>
            <ion-card-subtitle>{{ character.adjectives.join(', ') }} / {{ character.demeanor.join(', ') }}</ion-card-subtitle>
          </ion-card-header>

          <ion-card-content>
            <ion-row>
              <ion-col class="stat" *ngFor="let stat of content.getStats()">
                <div class="stat-name">
                  {{ stat }}
                </div>

                <div class="stat-value">
                  {{ characterHelper.getStatTotal(character, stat.toLowerCase()) | withPlus }}
                </div>
              </ion-col>
            </ion-row>
          </ion-card-content>
        </ion-card>

      </ion-col>

      <ion-col size="12" size-lg="6">

        <ion-card>
          <ion-card-header>
            <ion-card-title>Harm</ion-card-title>
          </ion-card-header>

          <ion-card-content>
            <ion-row *ngFor="let harm of ['Injury', 'Exhaustion', 'Depletion']" class="harm-row">
              <ion-col class="harm-label" (click)="adjustHarm(character, harm.toLowerCase(), 0)">{{ harm }}</ion-col>
              <ion-col class="harm-box"
                       *ngFor="let i of characterHelper.harmMax(character)"
                       (click)="adjustHarm(character, harm.toLowerCase(), i + 1)">
                <ion-icon [name]="character.harm[harm.toLowerCase()] > i ? 'checkbox-outline' : 'square-outline'"
                          *ngIf="i < characterHelper.harmCount(character, harm.toLowerCase())"></ion-icon>
              </ion-col>
            </ion-row>
          </ion-card-content>
        </ion-card>

      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col size="12" size-lg="6">

        <ion-card>
          <ion-card-header>
            <ion-card-title>Reputation</ion-card-title>
            <ion-icon class="change" name="list" (click)="changeFactions(character)" *ngIf="!character.campaign"></ion-icon>
          </ion-card-header>

          <ion-card-content>
            <ion-row *ngFor="let faction of character.reputation | keyvalue" class="reputation-row">
              <ion-col class="reputation-label">{{ faction.key }}</ion-col>
              <ion-col class="reputation-box">
                <ion-row>
                  <ion-col class="notoriety-level" (click)="lowerNotoriety(character, faction.key)">
                    -1
                  </ion-col>

                  <ion-col class="notoriety-track">
                    <ion-icon *ngFor="let i of [0, 1, 2]"
                              (click)="setNotoriety(character, faction.key, i + 1)"
                              [name]="getNotoriety(character, faction.key) > i ? 'checkbox-outline' : 'square-outline'"></ion-icon>
                  </ion-col>

                  <ion-col class="current-level">
                    {{ (character.reputation[faction.key].total || 0) | withPlus }}
                  </ion-col>

                  <ion-col class="prestige-track">
                    <ion-icon *ngFor="let i of [0, 1, 2, 3, 4]"
                              (click)="setPrestige(character, faction.key, i + 1)"
                              [name]="getPrestige(character, faction.key) > i ? 'checkbox-outline' : 'square-outline'"></ion-icon>
                  </ion-col>

                  <ion-col class="prestige-level" (click)="increasePrestige(character, faction.key)">
                    +1
                  </ion-col>
                </ion-row>
              </ion-col>
            </ion-row>
          </ion-card-content>
        </ion-card>

      </ion-col>

      <ion-col size="12" size-lg="6">

        <ion-card>
          <ion-card-header>
            <ion-card-title>Connections</ion-card-title>
            <ion-icon class="change" name="reload" (click)="changeConnections(character)"></ion-icon>
          </ion-card-header>

          <ion-card-content>
            <ion-list>
              <ion-item class="pointer" *ngFor="let connection of character.connections" (click)="viewConnection(connection.name)">
                {{ connection.name }} ({{ connection.target }})
              </ion-item>
            </ion-list>
          </ion-card-content>
        </ion-card>

      </ion-col>
    </ion-row>

  </ng-container>
</ion-content>
